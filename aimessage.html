<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AutoPost Pro â€” WhatsApp Football</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#07080f;--s1:#0b0d16;--s2:#0f1120;--s3:#141728;--s4:#1a1e30;--s5:#20243a;
  --rim:rgba(255,255,255,.055);--rim2:rgba(255,255,255,.10);--rim3:rgba(255,255,255,.18);
  --wa:#25d366;--wa2:#1ebe59;--wafog:rgba(37,211,102,.09);--waglow:rgba(37,211,102,.22);
  --red:#ff4545;--redfog:rgba(255,69,69,.10);
  --sky:#3cc8ff;--skyfog:rgba(60,200,255,.09);
  --amber:#ffb020;--ambfog:rgba(255,176,32,.09);
  --green:#3effa0;--grnfog:rgba(62,255,160,.09);
  --purple:#a855f7;--purpfog:rgba(168,85,247,.09);
  --white:#edf0ff;--grey:#7e879e;--dim:#3a4058;
  --display:'Bebas Neue',sans-serif;--body:'DM Sans',sans-serif;--mono:'DM Mono',monospace;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html{height:100%;font-size:16px;}
body{font-family:var(--body);background:var(--bg);color:var(--white);min-height:100vh;overflow-x:hidden;}
body::after{content:'';position:fixed;inset:0;z-index:9999;pointer-events:none;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.018'/%3E%3C/svg%3E");
  background-size:220px;}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}
@keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
@keyframes pop{0%{transform:scale(.85);opacity:0}70%{transform:scale(1.04)}100%{transform:scale(1);opacity:1}}
@keyframes glow-pulse{0%,100%{box-shadow:0 0 20px var(--waglow)}50%{box-shadow:0 0 40px rgba(37,211,102,.35)}}
@keyframes shimmer{0%{background-position:200% center}100%{background-position:-200% center}}
@keyframes msg-reveal{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
@keyframes ticker{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

/* HEADER */
.header{position:sticky;top:0;z-index:200;height:54px;display:flex;align-items:center;
  justify-content:space-between;padding:0 16px;background:rgba(7,8,15,.95);
  backdrop-filter:blur(20px);border-bottom:1px solid var(--rim);gap:10px;}
.logo{display:flex;align-items:center;gap:9px;font-family:var(--display);font-size:18px;
  letter-spacing:.06em;color:var(--white);text-decoration:none;flex-shrink:0;}
.logo-mark{width:28px;height:28px;background:var(--wa);border-radius:7px;display:flex;
  align-items:center;justify-content:center;font-size:14px;animation:glow-pulse 3s ease-in-out infinite;flex-shrink:0;}
.logo span.hi{color:var(--wa);}
.logo .badge{font-size:10px;color:var(--grey);font-family:var(--mono);margin-left:2px;}
.hdr-right{display:flex;align-items:center;gap:6px;flex-shrink:0;}
.hdr-btn{background:none;border:1px solid var(--rim);color:var(--dim);padding:5px 10px;
  border-radius:6px;font-size:11px;cursor:pointer;transition:.15s;font-family:var(--body);
  min-height:34px;display:flex;align-items:center;}
.hdr-btn:hover,.hdr-btn:active{border-color:var(--wa);color:var(--wa);}

/* TICKER */
.ticker-bar{height:28px;background:var(--s1);border-bottom:1px solid var(--rim);overflow:hidden;display:flex;align-items:center;}
.tk-label{padding:0 10px;font-family:var(--mono);font-size:9px;color:var(--wa);font-weight:600;
  letter-spacing:.1em;border-right:1px solid var(--rim);white-space:nowrap;height:100%;display:flex;align-items:center;flex-shrink:0;}
.tk-scroll{overflow:hidden;flex:1;}
.tk-inner{display:flex;animation:ticker 28s linear infinite;white-space:nowrap;}
.tk-item{padding:0 14px;font-family:var(--mono);font-size:10px;color:var(--grey);border-right:1px solid var(--rim);
  height:28px;display:flex;align-items:center;gap:5px;}
.tk-item .sc{color:var(--wa);font-weight:600;}
.tk-item .ld{color:var(--red);font-size:8px;font-weight:700;}

/* LAYOUT â€” Desktop: side by side. Mobile: stacked */
.app{display:grid;grid-template-columns:300px 1fr;min-height:calc(100vh - 82px);}
@media(max-width:768px){.app{grid-template-columns:1fr;}}

.col{display:flex;flex-direction:column;overflow:hidden;}
.col-l{border-right:1px solid var(--rim);}

/* NAV TABS (mobile only bottom nav) */
.mobile-nav{display:none;position:fixed;bottom:0;left:0;right:0;z-index:300;
  height:56px;background:rgba(7,8,15,.98);border-top:1px solid var(--rim2);
  display:none;align-items:center;justify-content:space-around;padding:0 4px;}
@media(max-width:768px){
  .mobile-nav{display:flex;}
  body{padding-bottom:56px;}
  .col-l{display:none;}
  .col-l.active{display:flex;}
  .col-m{display:none;}
  .col-m.active{display:flex;}
}
.mnav-btn{display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px 10px;
  border-radius:8px;cursor:pointer;transition:.15s;border:none;background:none;color:var(--dim);}
.mnav-btn.on{color:var(--wa);}
.mnav-btn .mni{font-size:18px;}
.mnav-btn .mnl{font-size:9px;font-family:var(--mono);font-weight:500;letter-spacing:.04em;}

/* SECTION HEADER */
.sec{display:flex;align-items:center;justify-content:space-between;padding:10px 14px 8px;
  border-bottom:1px solid var(--rim);flex-shrink:0;}
.sec-title{font-family:var(--mono);font-size:9px;font-weight:500;text-transform:uppercase;
  letter-spacing:.12em;color:var(--dim);display:flex;align-items:center;gap:6px;}
.sec-title::before{content:'';width:8px;height:2px;border-radius:1px;background:var(--wa);}
.sec-actions{display:flex;gap:4px;flex-wrap:wrap;}
.mb{background:none;border:1px solid var(--rim);color:var(--dim);padding:3px 9px;
  border-radius:4px;font-size:10px;font-family:var(--mono);cursor:pointer;transition:.12s;
  white-space:nowrap;min-height:28px;}
.mb:hover,.mb:active{border-color:var(--wa);color:var(--wa);}
.mb.on{border-color:var(--wa);color:var(--wa);background:var(--wafog);}
.mb.red{border-color:rgba(255,69,69,.2);color:var(--red);}
.mb.red:hover{border-color:var(--red);background:var(--redfog);}

/* MATCH LIST */
.date-nav{display:flex;align-items:center;justify-content:space-between;padding:7px 14px;
  border-bottom:1px solid var(--rim);flex-shrink:0;background:var(--s1);}
.dnb{background:none;border:1px solid var(--rim);color:var(--dim);width:30px;height:30px;
  border-radius:6px;cursor:pointer;font-size:14px;display:flex;align-items:center;justify-content:center;}
.dnb:hover,.dnb:active{border-color:var(--wa);color:var(--wa);}
.date-label{font-family:var(--mono);font-size:10px;color:var(--white);padding:4px 10px;
  border-radius:5px;border:1px solid var(--rim);cursor:pointer;}
.date-label:hover{border-color:var(--wa);color:var(--wa);}

.search-wrap{padding:8px 14px;border-bottom:1px solid var(--rim);flex-shrink:0;}
.search-inp{width:100%;background:var(--s2);border:1px solid var(--rim);border-radius:7px;
  padding:8px 12px;font-size:13px;color:var(--white);outline:none;font-family:var(--body);}
.search-inp:focus{border-color:var(--wa);}
.search-inp::placeholder{color:var(--dim);}

.scrollable{overflow-y:auto;flex:1;-webkit-overflow-scrolling:touch;}
.scrollable::-webkit-scrollbar{width:3px;}
.scrollable::-webkit-scrollbar-thumb{background:var(--s4);}

.league-hdr{padding:5px 14px;background:var(--s1);border-bottom:1px solid var(--rim);
  font-family:var(--mono);font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:.1em;}
.match-row{padding:12px 14px;border-bottom:1px solid var(--rim);cursor:pointer;transition:background .1s;position:relative;}
.match-row:hover,.match-row:active{background:var(--s2);}
.match-row.sel{background:var(--wafog);}
.match-row.sel::before{content:'';position:absolute;left:0;top:0;bottom:0;width:2px;background:var(--wa);}
.mr-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:4px;gap:6px;}
.mr-home,.mr-away{font-size:13px;font-weight:500;color:var(--white);max-width:38%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
.mr-score{font-family:var(--mono);font-size:12px;color:var(--wa);background:var(--wafog);padding:2px 8px;border-radius:4px;font-weight:600;flex-shrink:0;}
.mr-bot{display:flex;align-items:center;gap:5px;font-family:var(--mono);font-size:9px;color:var(--dim);}
.tag-live{display:inline-flex;align-items:center;gap:3px;padding:1px 6px;border-radius:3px;
  background:var(--redfog);color:var(--red);font-size:8px;font-weight:700;letter-spacing:.04em;}
.tag-live .p{width:4px;height:4px;border-radius:50%;background:var(--red);animation:blink .8s infinite;}
.tag-ft{display:inline-flex;padding:1px 6px;border-radius:3px;background:var(--s3);color:var(--dim);font-size:8px;}
.tag-sch{display:inline-flex;padding:1px 6px;border-radius:3px;background:var(--skyfog);color:var(--sky);font-size:8px;}

/* CONTROLS */
.controls-wrap{padding:10px 14px;border-bottom:1px solid var(--rim);display:flex;flex-direction:column;gap:8px;}
.ctrl-row{display:flex;gap:8px;align-items:center;}
.lbl{display:block;font-family:var(--mono);font-size:9px;font-weight:500;text-transform:uppercase;
  letter-spacing:.1em;color:var(--dim);margin-bottom:4px;}
.sel{width:100%;background:var(--s2);border:1px solid var(--rim2);border-radius:7px;
  color:var(--white);font-size:13px;padding:9px 10px;outline:none;font-family:var(--body);
  transition:.15s;appearance:none;cursor:pointer;min-height:40px;}
.sel:focus{border-color:var(--wa);}
.sel-wrap{position:relative;flex:1;}
.sel-wrap::after{content:'â–¾';position:absolute;right:10px;top:50%;transform:translateY(-50%);
  pointer-events:none;color:var(--dim);font-size:11px;}

.tog{display:flex;align-items:center;justify-content:space-between;padding:9px 14px;border-bottom:1px solid var(--rim);}
.tog-info{flex:1;}
.tog-name{font-size:13px;color:var(--white);}
.tog-sub{font-size:10px;color:var(--dim);font-family:var(--mono);margin-top:1px;}
.sw{position:relative;width:38px;height:22px;flex-shrink:0;margin-left:10px;}
.sw input{opacity:0;width:0;height:0;}
.sw-track{position:absolute;inset:0;cursor:pointer;background:var(--s4);border-radius:22px;border:1px solid var(--rim2);transition:.2s;}
.sw-track::before{content:'';position:absolute;width:12px;height:12px;border-radius:50%;left:4px;top:4px;background:var(--dim);transition:.2s;}
.sw input:checked+.sw-track{background:var(--wafog);border-color:rgba(37,211,102,.35);}
.sw input:checked+.sw-track::before{transform:translateX(16px);background:var(--wa);box-shadow:0 0 6px var(--wa);}

/* TEMPLATES */
.tpl-row{display:flex;flex-wrap:wrap;gap:5px;padding:10px 14px;border-bottom:1px solid var(--rim);}
.tpl-chip{padding:5px 11px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;
  border:1px solid var(--rim2);background:var(--s2);color:var(--grey);transition:.12s;white-space:nowrap;
  display:flex;align-items:center;gap:4px;min-height:32px;}
.tpl-chip:hover,.tpl-chip:active{border-color:var(--wa);color:var(--wa);background:var(--wafog);}
.tpl-chip.on{border-color:var(--wa);color:var(--wa);background:var(--wafog);}
.tpl-chip .tpl-del{opacity:0;font-size:10px;color:var(--red);transition:.1s;margin-left:2px;}
.tpl-chip:hover .tpl-del{opacity:1;}

/* GENERATE BUTTON */
.gen-wrap{padding:12px 14px;border-top:1px solid var(--rim);flex-shrink:0;}
.gen-btn{width:100%;padding:13px;background:linear-gradient(135deg,var(--wa),var(--wa2));border:none;
  border-radius:10px;font-family:var(--display);font-size:18px;letter-spacing:.06em;color:#fff;
  cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;gap:8px;
  box-shadow:0 3px 20px var(--wafog);position:relative;overflow:hidden;min-height:50px;}
.gen-btn::before{content:'';position:absolute;inset:0;background:linear-gradient(105deg,transparent 35%,rgba(255,255,255,.2) 50%,transparent 65%);background-size:200%;animation:shimmer 2.5s infinite;}
.gen-btn:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 6px 28px var(--waglow);}
.gen-btn:active:not(:disabled){transform:scale(.98);}
.gen-btn:disabled{opacity:.45;cursor:not-allowed;}

/* MESSAGE VIEW */
.mid-view{display:flex;flex-direction:column;min-height:calc(100vh - 82px);}
@media(max-width:768px){.mid-view{min-height:calc(100vh - 138px);}}

.msg-actions{display:flex;align-items:center;gap:5px;padding:8px 12px;
  border-bottom:1px solid var(--rim);flex-wrap:wrap;}
.action-btn{display:inline-flex;align-items:center;gap:4px;padding:7px 10px;border-radius:7px;
  font-size:12px;font-weight:500;cursor:pointer;border:1px solid var(--rim2);
  background:var(--s2);color:var(--grey);transition:.12s;font-family:var(--body);white-space:nowrap;min-height:34px;}
.action-btn:hover,.action-btn:active{color:var(--white);border-color:var(--rim3);background:var(--s3);}
.action-btn.wa{background:var(--wafog);color:var(--wa);border-color:rgba(37,211,102,.25);font-size:13px;font-weight:600;}
.action-btn.wa:hover,.action-btn.wa:active{background:rgba(37,211,102,.18);}
.ma-meta{font-family:var(--mono);font-size:10px;color:var(--dim);margin-left:auto;display:flex;gap:8px;align-items:center;}

/* CHAR LIMITS */
.char-bar{display:flex;gap:5px;padding:5px 12px;border-bottom:1px solid var(--rim);flex-wrap:wrap;}
.pb{display:inline-flex;align-items:center;gap:3px;padding:2px 7px;border-radius:4px;
  font-family:var(--mono);font-size:9px;border:1px solid var(--rim);background:var(--s2);}
.pb .pbc{color:var(--grey);}
.pb .pbc.ok{color:var(--green);}
.pb .pbc.warn{color:var(--amber);}
.pb .pbc.over{color:var(--red);}

/* HASHTAG BAR */
.hashtag-bar{padding:5px 12px;border-bottom:1px solid var(--rim);display:none;flex-wrap:wrap;gap:4px;}
.hashtag-bar.show{display:flex;}
.htag{padding:3px 8px;border-radius:12px;background:var(--purpfog);color:var(--purple);
  border:1px solid rgba(168,85,247,.2);font-family:var(--mono);font-size:9px;cursor:pointer;transition:.12s;}
.htag:hover,.htag:active{background:rgba(168,85,247,.18);}
.htag.added{opacity:.4;text-decoration:line-through;}

/* MESSAGE BODY */
.msg-body{flex:1;overflow-y:auto;padding:18px 16px;font-family:var(--mono);
  font-size:13px;line-height:1.85;color:var(--white);white-space:pre-wrap;word-break:break-word;
  min-height:200px;-webkit-overflow-scrolling:touch;}
.msg-body.rtl{direction:rtl;text-align:right;}
.msg-placeholder{display:flex;flex-direction:column;align-items:center;
  justify-content:center;text-align:center;gap:12px;padding:40px 20px;min-height:200px;}
.mp-icon{font-size:40px;opacity:.18;}
.mp-text{font-size:14px;color:var(--dim);font-family:var(--body);line-height:1.7;}
.mp-text strong{color:var(--wa);}
.msg-generated{animation:msg-reveal .3s ease;}
.gen-overlay{display:none;flex-direction:column;align-items:center;justify-content:center;
  gap:14px;padding:40px;min-height:200px;}
.ring-loader{width:40px;height:40px;border:2px solid var(--s4);border-top-color:var(--wa);
  border-right-color:var(--wa2);border-radius:50%;animation:spin .75s cubic-bezier(.5,.1,.5,.9) infinite;}
.gen-status-txt{font-family:var(--mono);font-size:11px;color:var(--grey);}

/* SHARE BUTTONS â€” Big, WhatsApp focused */
.share-section{padding:12px 14px;border-top:1px solid var(--rim);flex-shrink:0;}
.share-main{width:100%;padding:14px;background:linear-gradient(135deg,#25d366,#1ebe59);
  border:none;border-radius:10px;color:#fff;font-family:var(--display);font-size:20px;
  letter-spacing:.07em;cursor:pointer;transition:.2s;display:flex;align-items:center;justify-content:center;gap:10px;
  margin-bottom:8px;box-shadow:0 4px 20px rgba(37,211,102,.25);min-height:52px;}
.share-main:hover{transform:translateY(-1px);box-shadow:0 8px 28px rgba(37,211,102,.35);}
.share-main:active{transform:scale(.98);}
.share-sub-row{display:flex;gap:6px;}
.share-sub{flex:1;padding:10px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;
  border:1px solid transparent;transition:.15s;font-family:var(--body);display:flex;align-items:center;justify-content:center;gap:5px;min-height:40px;}
.share-sub.copy{background:var(--s3);color:var(--grey);border-color:var(--rim2);}
.share-sub.copy:hover,.share-sub.copy:active{color:var(--white);border-color:var(--rim3);}
.share-sub.dl{background:var(--s3);color:var(--grey);border-color:var(--rim2);}
.share-sub.dl:hover,.share-sub.dl:active{color:var(--white);border-color:var(--rim3);}
.share-sub.wa-group{background:rgba(37,211,102,.07);color:var(--wa);border-color:rgba(37,211,102,.2);}
.share-sub.wa-group:hover,.share-sub.wa-group:active{background:rgba(37,211,102,.15);}

.msg-footer{padding:6px 14px;border-top:1px solid var(--rim);display:flex;align-items:center;
  justify-content:space-between;font-family:var(--mono);font-size:10px;color:var(--dim);flex-shrink:0;}

/* QUICK POSTS GRID */
.qpost-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:10px 14px;}
.qp-btn{padding:10px 8px;background:var(--s2);border:1px solid var(--rim2);border-radius:8px;
  font-size:12px;font-weight:500;color:var(--grey);cursor:pointer;transition:.12s;text-align:center;
  font-family:var(--body);min-height:44px;display:flex;align-items:center;justify-content:center;gap:4px;}
.qp-btn:hover,.qp-btn:active{color:var(--white);border-color:var(--rim3);background:var(--s3);}

/* AFFILIATE */
.aff-panel{padding:12px 14px;border-bottom:1px solid var(--rim);background:linear-gradient(145deg,rgba(37,211,102,.05),transparent);border-left:2px solid var(--wa);}
.aff-hdr{font-family:var(--display);font-size:14px;letter-spacing:.05em;color:var(--wa);margin-bottom:8px;display:flex;align-items:center;gap:7px;}
.aff-badge{background:var(--wa);color:#000;padding:2px 7px;border-radius:4px;font-size:9px;font-weight:700;font-family:var(--mono);}
.inp{width:100%;background:var(--s2);border:1px solid var(--rim2);border-radius:7px;
  color:var(--white);font-size:13px;padding:9px 10px;outline:none;font-family:var(--body);transition:.15s;min-height:40px;}
.inp:focus{border-color:var(--wa);}
.textarea{width:100%;background:var(--s2);border:1px solid var(--rim2);border-radius:7px;
  color:var(--white);font-size:13px;padding:9px 10px;outline:none;font-family:var(--mono);
  resize:vertical;min-height:80px;transition:.15s;line-height:1.6;}
.textarea:focus{border-color:var(--wa);}

/* CUSTOM PROMPT */
.custom-prompt{display:none;padding:10px 14px;border-bottom:1px solid var(--rim);}

/* HISTORY */
.hist-item{padding:11px 14px;border-bottom:1px solid var(--rim);cursor:pointer;transition:background .1s;}
.hist-item:hover,.hist-item:active{background:var(--s2);}
.hi-top{display:flex;justify-content:space-between;margin-bottom:3px;gap:8px;}
.hi-title{font-size:12px;font-weight:600;color:var(--white);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;}
.hi-time{font-family:var(--mono);font-size:9px;color:var(--dim);flex-shrink:0;}
.hi-prev{font-size:11px;color:var(--dim);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}

/* MODALS */
.modal-bg{position:fixed;inset:0;z-index:900;background:rgba(7,8,15,.88);backdrop-filter:blur(8px);
  display:none;align-items:flex-end;justify-content:center;}
@media(min-width:769px){.modal-bg{align-items:center;}}
.modal-bg.open{display:flex;}
.modal{background:var(--s2);border:1px solid var(--rim2);border-radius:16px 16px 0 0;
  padding:20px;width:100%;max-height:90vh;overflow-y:auto;position:relative;animation:slideUp .2s ease;}
@media(min-width:769px){.modal{border-radius:14px;width:460px;max-width:92vw;}}
.modal-handle{width:36px;height:4px;background:var(--s4);border-radius:2px;margin:0 auto 16px;}
.modal h3{font-family:var(--display);font-size:22px;letter-spacing:.04em;margin-bottom:4px;}
.modal p{font-size:12px;color:var(--dim);font-family:var(--mono);margin-bottom:14px;}
.modal-close{position:absolute;top:16px;right:16px;background:none;border:none;color:var(--dim);font-size:20px;cursor:pointer;width:32px;height:32px;display:flex;align-items:center;justify-content:center;}
.modal-footer{display:flex;gap:8px;margin-top:14px;}
.btn-wa{flex:1;padding:13px;background:var(--wa);color:#fff;border:none;border-radius:9px;
  font-family:var(--display);font-size:17px;letter-spacing:.06em;cursor:pointer;min-height:48px;}
.btn-wa:active{background:var(--wa2);}
.btn-cancel{padding:13px 18px;background:var(--s3);color:var(--grey);border:1px solid var(--rim2);
  border-radius:9px;font-size:13px;cursor:pointer;font-family:var(--body);min-height:48px;}
.btn-cancel:active{color:var(--white);}

/* Settings sections */
.settings-section{background:var(--s3);border-radius:10px;padding:13px;margin-bottom:12px;}
.settings-section h4{font-family:var(--mono);font-size:10px;font-weight:500;text-transform:uppercase;
  letter-spacing:.1em;color:var(--wa);margin-bottom:10px;display:flex;align-items:center;gap:5px;}
.settings-section h4::before{content:'';width:5px;height:5px;border-radius:50%;background:var(--wa);}
.settings-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;flex-wrap:wrap;}
.settings-row:last-child{margin-bottom:0;}
.settings-row label{font-size:12px;color:var(--grey);min-width:90px;flex-shrink:0;}
.settings-row .inp,.settings-row .sel{flex:1;min-width:120px;}
.token-wrap{flex:1;position:relative;min-width:120px;}
.token-wrap .inp{padding-right:36px;}
.token-vis{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:var(--dim);cursor:pointer;font-size:16px;}

/* SCHEDULE */
.sched-item{display:flex;align-items:center;gap:8px;padding:10px 14px;border-bottom:1px solid var(--rim);flex-wrap:wrap;}
.si-time{font-family:var(--mono);font-size:10px;color:var(--amber);min-width:80px;}
.si-info{flex:1;}
.si-title{font-size:12px;font-weight:500;color:var(--white);}
.si-ch{font-size:10px;color:var(--dim);font-family:var(--mono);}
.si-status{font-family:var(--mono);font-size:9px;padding:2px 6px;border-radius:3px;flex-shrink:0;}
.si-status.pending{background:var(--ambfog);color:var(--amber);border:1px solid rgba(255,176,32,.2);}
.si-status.sent{background:var(--grnfog);color:var(--green);border:1px solid rgba(62,255,160,.2);}
.si-status.failed{background:var(--redfog);color:var(--red);border:1px solid rgba(255,69,69,.2);}

/* TYPE TABS */
.type-tabs{display:flex;border-bottom:1px solid var(--rim);padding:0 6px;flex-shrink:0;overflow-x:auto;}
.type-tabs::-webkit-scrollbar{display:none;}
.ttab{padding:10px 10px;font-size:12px;font-weight:500;color:var(--dim);cursor:pointer;
  border-bottom:2px solid transparent;transition:.12s;white-space:nowrap;flex-shrink:0;}
.ttab.on{color:var(--wa);border-bottom-color:var(--wa);}

/* EMPTY STATE */
.empty{text-align:center;padding:28px 16px;font-size:12px;color:var(--dim);font-family:var(--mono);line-height:1.8;}
.empty a{color:var(--wa);text-decoration:none;}
.sp-sm{display:inline-block;width:12px;height:12px;border:2px solid var(--rim2);
  border-top-color:var(--wa);border-radius:50%;animation:spin .6s linear infinite;vertical-align:middle;margin-right:5px;}

/* TOAST */
#toast{position:fixed;bottom:70px;left:50%;transform:translateX(-50%);z-index:9997;
  display:none;padding:10px 18px;border-radius:24px;font-size:13px;font-weight:500;
  font-family:var(--body);animation:slideUp .2s ease;box-shadow:0 6px 20px rgba(0,0,0,.6);
  white-space:nowrap;max-width:90vw;}
@media(min-width:769px){#toast{bottom:20px;}}
.t-ok{background:#0b2616;color:var(--green);border:1px solid rgba(62,255,160,.25);}
.t-err{background:#250b0b;color:var(--red);border:1px solid rgba(255,69,69,.25);}
.t-inf{background:#0b1625;color:var(--sky);border:1px solid rgba(60,200,255,.25);}
.t-wa{background:#0a1f0e;color:var(--wa);border:1px solid rgba(37,211,102,.25);}

/* FOCUS MATCH CARD (above msg on desktop) */
.focus-card{padding:12px 14px;border-bottom:1px solid var(--rim);}
.fc-league{font-family:var(--mono);font-size:9px;color:var(--dim);text-transform:uppercase;letter-spacing:.1em;margin-bottom:7px;}
.fc-score-grid{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:6px;text-align:center;margin-bottom:8px;}
.fc-team-name{font-size:12px;font-weight:600;}
.fc-score{font-family:var(--display);font-size:28px;letter-spacing:.04em;color:var(--wa);}
.fc-min{font-family:var(--mono);font-size:9px;color:var(--red);}
.fc-actions{display:flex;gap:4px;justify-content:center;flex-wrap:wrap;}

/* TYPE FILTER CHIPS */
.filter-chips{display:flex;gap:5px;padding:8px 14px;border-bottom:1px solid var(--rim);overflow-x:auto;}
.filter-chips::-webkit-scrollbar{display:none;}
.fchip{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;cursor:pointer;
  border:1px solid var(--rim2);background:var(--s2);color:var(--grey);transition:.12s;white-space:nowrap;min-height:30px;display:flex;align-items:center;}
.fchip.on{border-color:var(--wa);color:var(--wa);background:var(--wafog);}
.fchip:active{transform:scale(.96);}

/* Phone numbers section */
.phone-row{display:flex;align-items:center;gap:6px;padding:6px 0;border-bottom:1px solid var(--rim);}
.phone-row:last-child{border-bottom:none;}
.phone-row label{display:flex;align-items:center;gap:6px;flex:1;cursor:pointer;font-size:13px;color:var(--grey);}
.phone-row input[type=checkbox]{accent-color:var(--wa);width:16px;height:16px;cursor:pointer;flex-shrink:0;}
.phone-del{background:none;border:none;color:var(--dim);cursor:pointer;font-size:14px;padding:4px 6px;opacity:.5;}
.phone-del:hover,.phone-del:active{opacity:1;color:var(--red);}

/* Scheduled mini */
.sched-mini-item{display:flex;justify-content:space-between;align-items:center;
  padding:6px 0;border-bottom:1px solid var(--rim);font-size:12px;gap:6px;}
.sched-mini-item:last-child{border-bottom:none;}
.smi-title{color:var(--grey);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1;}
.smi-time{font-family:var(--mono);font-size:10px;color:var(--amber);flex-shrink:0;}

@media(max-width:400px){
  .share-sub-row{flex-wrap:wrap;}
  .share-sub{min-width:calc(50% - 3px);}
}
</style>
</head>
<body>

<header class="header">
  <a href="#" class="logo">
    <div class="logo-mark">ğŸ’¬</div>
    AUTOPOST<span class="hi">PRO</span>
    <span class="badge">FREE</span>
  </a>
  <div class="hdr-right">
    <button class="hdr-btn" onclick="openModal('modal-settings')">âš™</button>
    <button class="hdr-btn" onclick="openModal('modal-schedule')">â°</button>
  </div>
</header>

<div class="ticker-bar">
  <span class="tk-label">â— LIVE</span>
  <div class="tk-scroll"><div class="tk-inner" id="ticker-data"><span class="tk-item">âš½ Loading live scoresâ€¦</span><span class="tk-item">âš½ Loadingâ€¦</span></div></div>
</div>

<!-- APP GRID -->
<div class="app">

  <!-- LEFT: Match Picker + Controls -->
  <div class="col col-l" id="col-left">
    <div class="type-tabs">
      <div class="ttab on"  onclick="setType('live',this)">ğŸ”´ Live</div>
      <div class="ttab"     onclick="setType('preview',this)">ğŸ“… Preview</div>
      <div class="ttab"     onclick="setType('standings',this)">ğŸ† Table</div>
      <div class="ttab"     onclick="setType('digest',this)">ğŸ“Š Digest</div>
      <div class="ttab"     onclick="setType('custom',this)">âœï¸ Custom</div>
    </div>

    <div class="custom-prompt" id="custom-prompt">
      <label class="lbl">Custom Prompt</label>
      <textarea class="textarea" id="custom-txt" placeholder="e.g. Write an exciting WhatsApp message about Saka scoring in minute 67â€¦"></textarea>
    </div>

    <div class="date-nav" id="date-nav">
      <button class="dnb" onclick="shiftDate(-1)">â€¹</button>
      <span class="date-label" id="date-label" onclick="resetDate()">Today</span>
      <button class="dnb" onclick="shiftDate(1)">â€º</button>
    </div>

    <div class="sec" id="match-sec-hdr">
      <div class="sec-title">Fixtures</div>
      <div class="sec-actions">
        <button class="mb on" id="f-all"  onclick="filterBy('all')">All</button>
        <button class="mb"    id="f-live" onclick="filterBy('live')">Live</button>
        <button class="mb"    id="f-pin"  onclick="filterBy('pinned')">â­</button>
        <button class="mb"    onclick="loadMatches()">â†»</button>
      </div>
    </div>

    <div class="search-wrap" id="match-search-wrap">
      <input class="search-inp" type="text" placeholder="Search team or leagueâ€¦" oninput="searchMatches(this.value)">
    </div>

    <div class="scrollable" id="match-list">
      <div class="empty">Tap â†» to load matches</div>
    </div>

    <!-- AI Options -->
    <div class="sec"><div class="sec-title">AI Options</div></div>
    <div class="controls-wrap">
      <div>
        <label class="lbl">Tone</label>
        <div class="sel-wrap">
          <select class="sel" id="tone">
            <option value="excited">ğŸ”¥ Excited & Energetic</option>
            <option value="professional">ğŸ“° Professional</option>
            <option value="casual">ğŸ˜ Casual</option>
            <option value="dramatic">âš¡ Dramatic</option>
            <option value="analytical">ğŸ§® Analytical</option>
            <option value="poetic">ğŸ­ Poetic</option>
          </select>
        </div>
      </div>
      <div class="ctrl-row">
        <div style="flex:1;">
          <label class="lbl">Length</label>
          <div class="sel-wrap">
            <select class="sel" id="length">
              <option value="short">Short (2â€“3 lines)</option>
              <option value="medium" selected>Medium (4â€“6 lines)</option>
              <option value="detailed">Detailed (8â€“12 lines)</option>
            </select>
          </div>
        </div>
        <div style="flex:1;">
          <label class="lbl">Language</label>
          <div class="sel-wrap">
            <select class="sel" id="lang" onchange="onLangChange()">
              <option value="en">ğŸ‡¬ğŸ‡§ English</option>
              <option value="ar">ğŸ‡¸ğŸ‡¦ Arabic</option>
              <option value="fr">ğŸ‡«ğŸ‡· French</option>
              <option value="es">ğŸ‡ªğŸ‡¸ Spanish</option>
              <option value="pt">ğŸ‡§ğŸ‡· Portuguese</option>
              <option value="sw">ğŸ‡°ğŸ‡ª Swahili</option>
              <option value="de">ğŸ‡©ğŸ‡ª German</option>
              <option value="it">ğŸ‡®ğŸ‡¹ Italian</option>
              <option value="tr">ğŸ‡¹ğŸ‡· Turkish</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <div class="tog"><div class="tog-info"><div class="tog-name">Match stats</div><div class="tog-sub">possession, shots, corners</div></div><label class="sw"><input type="checkbox" id="inc-stats" checked><span class="sw-track"></span></label></div>
    <div class="tog"><div class="tog-info"><div class="tog-name">Top performers</div><div class="tog-sub">goals, assists, ratings</div></div><label class="sw"><input type="checkbox" id="inc-players" checked><span class="sw-track"></span></label></div>
    <div class="tog"><div class="tog-info"><div class="tog-name">Head-to-head history</div><div class="tog-sub">last 5 meetings</div></div><label class="sw"><input type="checkbox" id="inc-h2h"><span class="sw-track"></span></label></div>
    <div class="tog"><div class="tog-info"><div class="tog-name">Include affiliate link</div><div class="tog-sub">appended to messages</div></div><label class="sw"><input type="checkbox" id="inc-aff" checked><span class="sw-track"></span></label></div>
    <div class="tog"><div class="tog-info"><div class="tog-name">Emojis</div><div class="tog-sub">adds âš½ğŸ”¥ to message</div></div><label class="sw"><input type="checkbox" id="inc-emojis" checked><span class="sw-track"></span></label></div>
    <div class="tog"><div class="tog-info"><div class="tog-name">Auto hashtags</div><div class="tog-sub">appends #PremierLeague etc.</div></div><label class="sw"><input type="checkbox" id="inc-hashtags"><span class="sw-track"></span></label></div>

    <!-- Templates -->
    <div class="sec"><div class="sec-title">Templates</div><button class="mb" onclick="openModal('modal-tpl')">+ New</button></div>
    <div class="tpl-row" id="tpl-row">
      <span class="tpl-chip on" onclick="pickTpl(this,'default')">âš¡ Default</span>
      <span class="tpl-chip" onclick="pickTpl(this,'goal')">âš½ Goal</span>
      <span class="tpl-chip" onclick="pickTpl(this,'halftime')">ğŸ”” Half Time</span>
      <span class="tpl-chip" onclick="pickTpl(this,'fulltime')">ğŸ Full Time</span>
      <span class="tpl-chip" onclick="pickTpl(this,'preview')">ğŸ“… Preview</span>
      <span class="tpl-chip" onclick="pickTpl(this,'red')">ğŸŸ¥ Red Card</span>
      <span class="tpl-chip" onclick="pickTpl(this,'lineups')">ğŸ“‹ Lineups</span>
      <span class="tpl-chip" onclick="pickTpl(this,'penalty')">ğŸ¯ Penalty</span>
    </div>

    <!-- Affiliate -->
    <div class="aff-panel">
      <div class="aff-hdr">ğŸ’š AFFILIATE LINK <span class="aff-badge">OPTIONAL</span></div>
      <div style="display:flex;flex-direction:column;gap:7px;">
        <input class="inp" id="aff-label" type="text" placeholder="ğŸ”— Label e.g. Bet365" value="ğŸ”— Bet Now">
        <div style="display:flex;gap:6px;">
          <input class="inp" id="aff-url" type="url" placeholder="https://your-link.com" style="flex:1;">
          <button class="mb" onclick="saveAffiliate()" style="white-space:nowrap;padding:9px 12px;">Save</button>
        </div>
      </div>
    </div>

    <div class="gen-wrap">
      <button class="gen-btn" id="gen-btn" onclick="generate()">
        <span style="font-size:18px;">ğŸ’¬</span> GENERATE MESSAGE
      </button>
    </div>
  </div>

  <!-- RIGHT: Message + Share -->
  <div class="col col-m active" id="col-right">

    <!-- Focus card for desktop -->
    <div class="focus-card" id="focus-card" style="display:none;">
      <div class="fc-league" id="fc-league">â€”</div>
      <div class="fc-score-grid">
        <div><div style="font-size:18px;margin-bottom:3px;">ğŸŸ¢</div><div class="fc-team-name" id="fc-home">â€”</div></div>
        <div style="text-align:center;"><div class="fc-score" id="fc-score">â€“</div><div class="fc-min" id="fc-min"></div></div>
        <div><div style="font-size:18px;margin-bottom:3px;">ğŸ”µ</div><div class="fc-team-name" id="fc-away">â€”</div></div>
      </div>
      <div class="fc-actions">
        <button class="mb" onclick="quickPost('goal','','','')">âš½ Goal</button>
        <button class="mb" onclick="quickPost('halftime','','','')">ğŸ”” HT</button>
        <button class="mb" onclick="quickPost('fulltime','','','')">ğŸ FT</button>
        <button class="mb on" onclick="generate()">âœ¦ Generate</button>
      </div>
    </div>

    <!-- Quick Posts -->
    <div class="sec"><div class="sec-title">Quick Posts</div></div>
    <div class="qpost-grid">
      <button class="qp-btn" onclick="quickPost('goal','','','')">âš½ Goal Alert</button>
      <button class="qp-btn" onclick="quickPost('halftime','','','')">ğŸ”” Half Time</button>
      <button class="qp-btn" onclick="quickPost('fulltime','','','')">ğŸ Full Time</button>
      <button class="qp-btn" onclick="quickPost('red','','','')">ğŸŸ¥ Red Card</button>
      <button class="qp-btn" onclick="quickPost('penalty','','','')">ğŸ¯ Penalty</button>
      <button class="qp-btn" onclick="quickPost('var','','','')">ğŸ“º VAR Review</button>
      <button class="qp-btn" onclick="quickPost('kickoff','','','')">ğŸŸï¸ Kick Off</button>
      <button class="qp-btn" onclick="quickPost('injury','','','')">ğŸš‘ Injury</button>
    </div>

    <!-- Message area -->
    <div class="sec">
      <div class="sec-title">Generated Message</div>
      <div class="ma-meta">
        <span id="gen-ts"></span>
        <span id="char-count"></span>
      </div>
    </div>

    <div class="msg-actions">
      <button class="action-btn" onclick="copyMsg()">ğŸ“‹ Copy</button>
      <button class="action-btn" onclick="editMsg()" id="edit-btn">âœï¸ Edit</button>
      <button class="action-btn" onclick="regenerate()">â†» Retry</button>
      <button class="action-btn" onclick="saveMsg()">ğŸ’¾ Save</button>
      <button class="action-btn" onclick="toggleHashtags()" id="hashtag-btn"># Tags</button>
    </div>

    <div class="char-bar">
      <div class="pb"><span>ğŸ’¬</span><span class="pbc" id="pb-wa">0 chars</span></div>
      <div class="pb"><span>ğŸ“¸</span><span class="pbc" id="pb-ig">0/2200</span></div>
    </div>

    <div class="hashtag-bar" id="hashtag-bar"></div>

    <div class="msg-body" id="msg-body">
      <div class="msg-placeholder" id="msg-ph">
        <div class="mp-icon">ğŸ’¬</div>
        <p class="mp-text">
          Select a match, choose your tone,<br>then tap <strong>Generate Message</strong><br>
          <span style="font-size:11px;color:var(--grey);margin-top:8px;display:block;">Tap Quick Posts for instant alerts</span>
          <span style="font-size:12px;color:var(--wa);margin-top:4px;display:block;">âš¡ 100% FREE Â· No limits</span>
        </p>
      </div>
      <span id="msg-txt" style="display:none;"></span>
      <div class="gen-overlay" id="gen-overlay">
        <div class="ring-loader"></div>
        <div class="gen-status-txt" id="gen-status">Crafting your messageâ€¦</div>
      </div>
    </div>

    <!-- SHARE â€” WhatsApp primary -->
    <div class="share-section" id="share-section" style="display:none;">
      <button class="share-main" onclick="shareWhatsApp()">
        <span style="font-size:22px;">ğŸ’¬</span> SHARE ON WHATSAPP
      </button>
      <div class="share-sub-row">
        <button class="share-sub wa-group" onclick="shareWhatsAppStatus()">ğŸ“¢ WA Status</button>
        <button class="share-sub copy" onclick="copyMsg()">ğŸ“‹ Copy Text</button>
        <button class="share-sub dl" onclick="downloadMsg()">â¬‡ Save .txt</button>
      </div>
    </div>

    <!-- Always visible minimal share -->
    <div id="share-always">
      <div class="share-section" style="padding-top:8px;">
        <button class="share-main" onclick="shareWhatsApp()" style="opacity:.5;">
          <span style="font-size:22px;">ğŸ’¬</span> SHARE ON WHATSAPP
        </button>
      </div>
    </div>

    <div class="msg-footer">
      <span id="msg-footer-l">Ready Â· Generate a message to share</span>
      <span>AutoPost Pro ğŸ’¬</span>
    </div>

    <!-- HISTORY -->
    <div class="sec" style="margin-top:10px;">
      <div class="sec-title">Message History</div>
      <div class="sec-actions">
        <button class="mb" onclick="exportHistory('json')">â¬‡ JSON</button>
        <button class="mb red" onclick="clearHistory()">ğŸ—‘ Clear</button>
      </div>
    </div>
    <div id="hist-list"><div class="empty">No history yet</div></div>

    <!-- SCHEDULED -->
    <div class="sec" style="margin-top:4px;">
      <div class="sec-title">Scheduled</div>
      <button class="mb" onclick="openModal('modal-schedule')">+ New</button>
    </div>
    <div id="sched-list-mini"><div class="empty" style="padding:12px 16px;font-size:11px;">No scheduled posts</div></div>

  </div>
</div>

<!-- MOBILE BOTTOM NAV -->
<nav class="mobile-nav">
  <button class="mnav-btn on" onclick="mobileNav('left',this)" id="mnav-matches">
    <span class="mni">âš½</span><span class="mnl">MATCHES</span>
  </button>
  <button class="mnav-btn" onclick="mobileNav('right',this)" id="mnav-message">
    <span class="mni">ğŸ’¬</span><span class="mnl">MESSAGE</span>
  </button>
  <button class="mnav-btn" onclick="mobileGenerate()" id="mnav-generate">
    <span class="mni" style="background:var(--wa);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;font-size:20px;">âœ¦</span>
    <span class="mnl">GENERATE</span>
  </button>
  <button class="mnav-btn" onclick="openModal('modal-history')" id="mnav-history">
    <span class="mni">ğŸ“‹</span><span class="mnl">HISTORY</span>
  </button>
  <button class="mnav-btn" onclick="openModal('modal-settings')" id="mnav-settings">
    <span class="mni">âš™ï¸</span><span class="mnl">SETTINGS</span>
  </button>
</nav>

<!-- â•â• MODALS â•â• -->

<!-- SETTINGS -->
<div class="modal-bg" id="modal-settings">
<div class="modal">
  <div class="modal-handle"></div>
  <button class="modal-close" onclick="closeModal('modal-settings')">âœ•</button>
  <h3>âš™ï¸ Settings</h3>
  <p>Configure API and preferences</p>
  <div class="settings-section">
    <h4>Football Data API</h4>
    <div class="settings-row">
      <label>API Base URL</label>
      <input class="inp" type="url" id="api-base-inp" placeholder="https://your-backend.com" style="font-family:var(--mono);font-size:11px;">
    </div>
    <div class="settings-row">
      <label>API-Football Key</label>
      <div class="token-wrap">
        <input class="inp" type="password" id="football-key-inp" placeholder="api-football.com key" style="font-family:var(--mono);font-size:11px;">
        <button class="token-vis" onclick="toggleVis('football-key-inp')">ğŸ‘</button>
      </div>
    </div>
    <div style="font-size:10px;color:var(--dim);font-family:var(--mono);margin-top:4px;">Free: 100 req/day Â· api-football.com</div>
  </div>
  <div class="settings-section">
    <h4>Preferences</h4>
    <div class="settings-row">
      <label>Default League</label>
      <div class="sel-wrap" style="flex:1;">
        <select class="sel" id="pref-league" style="font-size:12px;">
          <option value="39">ğŸ´ó §ó ¢ó ¥ó ®ó §ó ¿ Premier League</option>
          <option value="140">ğŸ‡ªğŸ‡¸ La Liga</option>
          <option value="135">ğŸ‡®ğŸ‡¹ Serie A</option>
          <option value="78">ğŸ‡©ğŸ‡ª Bundesliga</option>
          <option value="61">ğŸ‡«ğŸ‡· Ligue 1</option>
          <option value="2">ğŸ† UCL</option>
          <option value="307">ğŸ‡¸ğŸ‡¦ Saudi Pro</option>
        </select>
      </div>
    </div>
    <div class="settings-row">
      <label>Season</label>
      <input class="inp" type="number" id="pref-season" placeholder="2024" value="2024" style="font-family:var(--mono);max-width:100px;">
    </div>
    <div class="settings-row">
      <label>Auto-Refresh</label>
      <div class="sel-wrap" style="flex:1;">
        <select class="sel" id="pref-refresh" style="font-size:12px;">
          <option value="60" selected>Every 1 min</option>
          <option value="120">Every 2 min</option>
          <option value="300">Every 5 min</option>
          <option value="0">Off</option>
        </select>
      </div>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn-wa" onclick="saveSettings()">SAVE SETTINGS</button>
    <button class="btn-cancel" onclick="closeModal('modal-settings')">Cancel</button>
  </div>
</div>
</div>

<!-- TEMPLATE CREATOR -->
<div class="modal-bg" id="modal-tpl">
<div class="modal">
  <div class="modal-handle"></div>
  <button class="modal-close" onclick="closeModal('modal-tpl')">âœ•</button>
  <h3>New Template</h3>
  <p>Define custom AI instructions</p>
  <div style="display:flex;flex-direction:column;gap:10px;">
    <div><label class="lbl">Name</label><input class="inp" id="tpl-name-inp" type="text" placeholder="e.g. Goal Alert Arabic"></div>
    <div><label class="lbl">Emoji Icon</label><input class="inp" id="tpl-icon-inp" type="text" placeholder="âš½" style="max-width:80px;"></div>
    <div><label class="lbl">Prompt Instructions</label>
      <textarea class="textarea" id="tpl-prompt-inp" placeholder="Write a 3-line goal alert in Arabic. Include player name, minute, score. Use fire emoji."></textarea>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn-wa" onclick="saveCustomTemplate()">SAVE TEMPLATE</button>
    <button class="btn-cancel" onclick="closeModal('modal-tpl')">Cancel</button>
  </div>
</div>
</div>

<!-- SCHEDULE -->
<div class="modal-bg" id="modal-schedule">
<div class="modal">
  <div class="modal-handle"></div>
  <button class="modal-close" onclick="closeModal('modal-schedule')">âœ•</button>
  <h3>â° Schedule Post</h3>
  <p>Set a time to be reminded to share on WhatsApp</p>
  <div style="display:flex;flex-direction:column;gap:10px;">
    <div><label class="lbl">Date & Time</label><input class="inp" type="datetime-local" id="sched-dt"></div>
    <div><label class="lbl">Label / Note</label><input class="inp" id="sched-note" type="text" placeholder="e.g. Arsenal match preview"></div>
    <div><label class="lbl">Message</label><textarea class="textarea" id="sched-msg-preview" style="min-height:80px;" placeholder="Auto-filled from current message, or type hereâ€¦"></textarea></div>
  </div>
  <div class="modal-footer">
    <button class="btn-wa" onclick="schedulePost()">SCHEDULE REMINDER</button>
    <button class="btn-cancel" onclick="closeModal('modal-schedule')">Cancel</button>
  </div>
</div>
</div>

<!-- HISTORY MODAL (mobile) -->
<div class="modal-bg" id="modal-history">
<div class="modal" style="max-height:85vh;">
  <div class="modal-handle"></div>
  <button class="modal-close" onclick="closeModal('modal-history')">âœ•</button>
  <h3>ğŸ“‹ History</h3>
  <p>Previously generated messages</p>
  <div style="display:flex;gap:6px;margin-bottom:12px;">
    <button class="mb" onclick="exportHistory('json')">â¬‡ JSON</button>
    <button class="mb red" onclick="clearHistory()">ğŸ—‘ Clear All</button>
  </div>
  <div id="hist-list-modal" style="max-height:50vh;overflow-y:auto;"><div class="empty">No history yet</div></div>
</div>
</div>

<div id="toast"></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentType    = 'live';
let currentTpl     = 'default';
let selectedMatchId = null;
let allMatches     = [];
let generatedMsg   = '';
let pinnedMatches  = new Set();
let hashtagsShown  = false;
let currentDate    = new Date();
let refreshInt     = null;
let schedulerInt   = null;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
  loadSettings();
  loadMatches();
  loadPinnedMatches();
  loadCustomTemplates();
  loadHistoryFromStorage();
  loadScheduledPosts();
  loadAffiliate();
  updateTicker();
  startAutoRefresh();
  startSchedulerEngine();
  setInterval(updateTicker, 30000);
  // Show focus card on desktop
  checkDesktop();
  window.addEventListener('resize', checkDesktop);
  // Pre-fill schedule dt
  const now = new Date(Date.now() + 60*60*1000);
  const pad = n => String(n).padStart(2,'0');
  document.getElementById('sched-dt').value = 
    `${now.getFullYear()}-${pad(now.getMonth()+1)}-${pad(now.getDate())}T${pad(now.getHours())}:${pad(now.getMinutes())}`;
});

function checkDesktop() {
  const fc = document.getElementById('focus-card');
  if (window.innerWidth > 768) fc.style.display = 'block';
  else fc.style.display = 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MOBILE NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function mobileNav(side, el) {
  const left  = document.getElementById('col-left');
  const right = document.getElementById('col-right');
  document.querySelectorAll('.mnav-btn').forEach(b => b.classList.remove('on'));
  el.classList.add('on');
  if (side === 'left') {
    left.classList.add('active');
    right.classList.remove('active');
  } else {
    right.classList.add('active');
    left.classList.remove('active');
  }
}

function mobileGenerate() {
  // Switch to message view then generate
  const right = document.getElementById('col-right');
  const left  = document.getElementById('col-left');
  right.classList.add('active');
  left.classList.remove('active');
  document.querySelectorAll('.mnav-btn').forEach(b => b.classList.remove('on'));
  document.getElementById('mnav-message').classList.add('on');
  generate();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SETTINGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cfg() { return JSON.parse(localStorage.getItem('ap_settings') || '{}'); }
function base() { return cfg().apiBase || ''; }

function loadSettings() {
  const s = cfg();
  if (s.apiBase)     document.getElementById('api-base-inp').value     = s.apiBase;
  if (s.footballKey) document.getElementById('football-key-inp').value = s.footballKey;
  if (s.prefLeague)  document.getElementById('pref-league').value      = s.prefLeague;
  if (s.prefSeason)  document.getElementById('pref-season').value      = s.prefSeason;
  if (s.prefRefresh) document.getElementById('pref-refresh').value     = s.prefRefresh;
}

function saveSettings() {
  const s = {
    apiBase:     document.getElementById('api-base-inp').value.trim(),
    footballKey: document.getElementById('football-key-inp').value.trim(),
    prefLeague:  document.getElementById('pref-league').value,
    prefSeason:  document.getElementById('pref-season').value || '2024',
    prefRefresh: document.getElementById('pref-refresh').value,
  };
  localStorage.setItem('ap_settings', JSON.stringify(s));
  startAutoRefresh();
  closeModal('modal-settings');
  toast('Settings saved âœ“','wa');
}

function toggleVis(id) {
  const el = document.getElementById(id);
  el.type = el.type === 'password' ? 'text' : 'password';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATE NAV
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fmtDate(d) {
  const today    = new Date(); today.setHours(0,0,0,0);
  const tomorrow = new Date(today); tomorrow.setDate(today.getDate()+1);
  const yesterday= new Date(today); yesterday.setDate(today.getDate()-1);
  const t = new Date(d); t.setHours(0,0,0,0);
  if (t.getTime() === today.getTime())     return 'Today';
  if (t.getTime() === tomorrow.getTime())  return 'Tomorrow';
  if (t.getTime() === yesterday.getTime()) return 'Yesterday';
  return d.toLocaleDateString([], {weekday:'short', month:'short', day:'numeric'});
}

function shiftDate(dir) {
  currentDate = new Date(currentDate);
  currentDate.setDate(currentDate.getDate() + dir);
  updateDateLabel();
  loadMatches();
}

function resetDate() {
  currentDate = new Date();
  updateDateLabel();
  loadMatches();
}

function updateDateLabel() {
  document.getElementById('date-label').textContent = fmtDate(currentDate);
}

function apiDateStr(d) { return d.toISOString().split('T')[0]; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTO REFRESH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startAutoRefresh() {
  clearInterval(refreshInt);
  const s = cfg();
  const secs = parseInt(s.prefRefresh || 60);
  if (!secs) return;
  refreshInt = setInterval(() => { loadMatches(); updateTicker(); }, secs * 1000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCHEDULER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startSchedulerEngine() {
  clearInterval(schedulerInt);
  schedulerInt = setInterval(runScheduler, 30000);
  runScheduler();
}

function runScheduler() {
  const sched = JSON.parse(localStorage.getItem('ap_scheduled') || '[]');
  const now = new Date();
  let changed = false;
  sched.forEach(post => {
    if (post.status !== 'pending') return;
    if (new Date(post.datetime) <= now) {
      post.status = 'due';
      post.firedAt = new Date().toISOString();
      changed = true;
      // Trigger a reminder notification/prompt
      fireScheduledReminder(post);
    }
  });
  if (changed) {
    localStorage.setItem('ap_scheduled', JSON.stringify(sched));
    loadScheduledPosts();
  }
}

function fireScheduledReminder(post) {
  // Load message into composer and prompt user to share
  if (post.message) {
    generatedMsg = post.message;
    const txt = document.getElementById('msg-txt');
    txt.textContent = generatedMsg;
    txt.style.display = 'block';
    document.getElementById('msg-ph').style.display = 'none';
    document.getElementById('share-section').style.display = 'block';
    document.getElementById('share-always').style.display = 'none';
    updateCharLimits();
  }
  toast(`â° Reminder: "${post.note || 'Scheduled post'}" â€” tap Share!`, 'wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TICKER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function updateTicker() {
  try {
    const res  = await fetch(base() + '/api/matches/live');
    const data = await res.json();
    const live = data.matches || [];
    const el   = document.getElementById('ticker-data');
    if (!live.length) {
      el.innerHTML = '<span class="tk-item">âš½ No live matches right now</span>'.repeat(4);
      return;
    }
    let html = '';
    for (let i = 0; i < 8; i++) {
      const m = live[i % live.length];
      html += `<span class="tk-item"><span class="ld">LIVE</span>${m.teams.home.name} vs ${m.teams.away.name}<span class="sc"> ${m.goals.home}â€“${m.goals.away}</span><span style="color:var(--red);font-size:9px;"> ${m.fixture.status.elapsed||0}'</span></span>`;
    }
    el.innerHTML = html;
  } catch {
    document.getElementById('ticker-data').innerHTML = '<span class="tk-item">âš½ Add API URL in Settings for live scores</span>'.repeat(3);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MATCHES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadMatches() {
  const list = document.getElementById('match-list');
  list.innerHTML = '<div class="empty"><span class="sp-sm"></span>Loadingâ€¦</div>';
  updateDateLabel();
  try {
    const dateStr = apiDateStr(currentDate);
    const isToday = fmtDate(currentDate) === 'Today';
    const [liveRes, dayRes] = await Promise.all([
      isToday ? fetch(base() + '/api/matches/live') : Promise.resolve({json:()=>({matches:[]})}),
      fetch(base() + `/api/matches/today?date=${dateStr}`)
    ]);
    const liveData = isToday ? await liveRes.json() : {matches:[]};
    const dayData  = await dayRes.json();
    const live     = liveData.matches || [];
    const day      = dayData.matches  || [];
    const liveSet  = new Set(live.map(m => m.fixture.id));
    allMatches = [...live, ...day.filter(m => !liveSet.has(m.fixture.id))];
    renderMatchList(allMatches, liveSet);
    if (allMatches.length) selectMatch(allMatches[0].fixture.id);
  } catch {
    list.innerHTML = '<div class="empty">âš ï¸ API unreachable.<br><a href="#" onclick="openModal(\'modal-settings\');return false;">Configure in Settings â†’</a></div>';
    renderDemoMatches();
  }
}

function renderDemoMatches() {
  const demos = [
    {fixture:{id:1,date:new Date().toISOString(),status:{short:'LIVE',elapsed:54},venue:{name:'Anfield'}},league:{id:39,name:'Premier League',round:'Round 30'},teams:{home:{id:40,name:'Liverpool'},away:{id:50,name:'Man City'}},goals:{home:2,away:1}},
    {fixture:{id:2,date:new Date(Date.now()+7200000).toISOString(),status:{short:'NS',elapsed:null},venue:{name:'Old Trafford'}},league:{id:39,name:'Premier League',round:'Round 30'},teams:{home:{id:33,name:'Man United'},away:{id:42,name:'Arsenal'}},goals:{home:null,away:null}},
    {fixture:{id:3,date:new Date(Date.now()+10800000).toISOString(),status:{short:'NS',elapsed:null},venue:{name:'BernabÃ©u'}},league:{id:140,name:'La Liga',round:'Round 29'},teams:{home:{id:541,name:'Real Madrid'},away:{id:529,name:'Barcelona'}},goals:{home:null,away:null}},
    {fixture:{id:4,date:new Date(Date.now()-3600000).toISOString(),status:{short:'FT',elapsed:90},venue:{name:'San Siro'}},league:{id:135,name:'Serie A',round:'Round 31'},teams:{home:{id:489,name:'AC Milan'},away:{id:492,name:'Napoli'}},goals:{home:1,away:1}},
  ];
  allMatches = demos;
  const liveSet = new Set([1]);
  renderMatchList(demos, liveSet);
  selectMatch(1);
}

function renderMatchList(matches, liveSet) {
  const list = document.getElementById('match-list');
  if (!matches.length) { list.innerHTML = '<div class="empty">No fixtures for this date</div>'; return; }
  const sorted = [...matches].sort((a,b) => (pinnedMatches.has(a.fixture.id)?0:1) - (pinnedMatches.has(b.fixture.id)?0:1));
  let lastLeague='', html='';
  sorted.slice(0,30).forEach(m => {
    const lg = m.league.name;
    if (lg !== lastLeague) { html += `<div class="league-hdr">${lg}</div>`; lastLeague = lg; }
    const isLive = liveSet && liveSet.has(m.fixture.id);
    const score  = m.goals.home !== null ? `${m.goals.home}â€“${m.goals.away}` : 'vs';
    const time   = isLive
      ? `<span class="tag-live"><span class="p"></span>LIVE</span> ${m.fixture.status.elapsed||0}'`
      : m.fixture.status.short === 'FT' ? '<span class="tag-ft">FT</span>'
      : `<span class="tag-sch">${new Date(m.fixture.date).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span>`;
    html += `<div class="match-row${pinnedMatches.has(m.fixture.id)?' pinned':''}" onclick="selectMatchAndSwitch(${m.fixture.id})" id="mi-${m.fixture.id}">
      <div class="mr-top">
        <span class="mr-home">${m.teams.home.name}</span>
        <span class="mr-score">${score}</span>
        <span class="mr-away">${m.teams.away.name}</span>
      </div>
      <div class="mr-bot">${time}<span>Â·</span>${m.fixture.venue?.name||''}</div>
    </div>`;
  });
  list.innerHTML = html;
}

function selectMatchAndSwitch(id) {
  selectMatch(id);
  // On mobile, switch to message view after picking
  if (window.innerWidth <= 768) {
    const right = document.getElementById('col-right');
    const left  = document.getElementById('col-left');
    right.classList.add('active');
    left.classList.remove('active');
    document.querySelectorAll('.mnav-btn').forEach(b => b.classList.remove('on'));
    document.getElementById('mnav-message').classList.add('on');
  }
}

function selectMatch(id) {
  document.querySelectorAll('.match-row').forEach(r => r.classList.remove('sel'));
  document.getElementById('mi-'+id)?.classList.add('sel');
  selectedMatchId = id;
  const m = allMatches.find(m => m.fixture.id === id);
  if (!m) return;
  const score  = m.goals.home !== null ? `${m.goals.home}â€“${m.goals.away}` : 'vs';
  const status = m.fixture.status;
  document.getElementById('fc-home').textContent   = m.teams.home.name;
  document.getElementById('fc-away').textContent   = m.teams.away.name;
  document.getElementById('fc-score').textContent  = score;
  document.getElementById('fc-league').textContent = `${m.league.name} Â· ${m.league.round||''}`;
  document.getElementById('fc-min').textContent    = status.elapsed ? `â— ${status.elapsed}'` : status.short==='FT'?'FT':'';
  generateHashtagSuggestions(m);
}

function filterBy(f) {
  ['all','live','pin'].forEach(k => document.getElementById('f-'+k)?.classList.toggle('on', k===f));
  document.querySelectorAll('.match-row').forEach(r => {
    if (f==='live')   r.style.display = r.querySelector('.tag-live') ? '' : 'none';
    else if (f==='pin') r.style.display = r.classList.contains('pinned') ? '' : 'none';
    else r.style.display = '';
  });
}

function searchMatches(q) {
  document.querySelectorAll('.match-row,.league-hdr').forEach(r => {
    if (!q) { r.style.display=''; return; }
    if (r.classList.contains('league-hdr')) { r.style.display=''; return; }
    r.style.display = r.textContent.toLowerCase().includes(q.toLowerCase()) ? '' : 'none';
  });
}

function loadPinnedMatches() {
  pinnedMatches = new Set(JSON.parse(localStorage.getItem('ap_pinned')||'[]'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HASHTAGS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateHashtagSuggestions(m) {
  const bar = document.getElementById('hashtag-bar');
  if (!m) { bar.innerHTML=''; return; }
  const leagueMap={'Premier League':'PremierLeague','La Liga':'LaLiga','Serie A':'SerieA',
    'Champions League':'UCL','Bundesliga':'Bundesliga','Ligue 1':'Ligue1','Saudi Pro League':'SPL'};
  const tags = [
    m.teams.home.name.replace(/\s/g,''),
    m.teams.away.name.replace(/\s/g,''),
    leagueMap[m.league.name] || m.league.name.replace(/\s/g,''),
    'Football','Soccer',
  ];
  if (m.fixture.status.elapsed) tags.push('LiveFootball');
  bar.innerHTML = tags.map(t=>`<span class="htag" onclick="appendHashtag(this,'${t}')">#${t}</span>`).join('');
}

function appendHashtag(el, tag) {
  if (!generatedMsg) { toast('Generate a message first','err'); return; }
  if (el.classList.contains('added')) return;
  generatedMsg += ` #${tag}`;
  document.getElementById('msg-txt').textContent = generatedMsg;
  el.classList.add('added');
  updateCharLimits();
  toast(`#${tag} added`,'wa');
}

function toggleHashtags() {
  hashtagsShown = !hashtagsShown;
  document.getElementById('hashtag-bar').classList.toggle('show', hashtagsShown);
  const btn = document.getElementById('hashtag-btn');
  btn.style.borderColor = hashtagsShown ? 'var(--purple)' : '';
  btn.style.color       = hashtagsShown ? 'var(--purple)' : '';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEMPLATES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const BUILTIN_TPLS = {
  'default':  { icon:'âš¡', prompt:'Write a comprehensive WhatsApp match update with score, key events, and atmosphere.' },
  'goal':     { icon:'âš½', prompt:'Write an explosive WhatsApp goal alert. Include player name, minute, current score. Capture the excitement with fire emojis.' },
  'halftime': { icon:'ğŸ””', prompt:'Write a half-time WhatsApp summary. Include the score, key moments from the first half, and what to watch in the second half.' },
  'fulltime': { icon:'ğŸ', prompt:'Write a full-time WhatsApp match report. Summarize the result, key players, turning points.' },
  'preview':  { icon:'ğŸ“…', prompt:'Write a WhatsApp pre-match preview. Include team form, key players to watch, and prediction.' },
  'red':      { icon:'ğŸŸ¥', prompt:'Write a red card WhatsApp alert. Include player name, minute, team, and impact on the match. Be dramatic.' },
  'lineups':  { icon:'ğŸ“‹', prompt:'Write a WhatsApp lineup announcement. List both starting XIs, highlight key players, note any surprises.' },
  'penalty':  { icon:'ğŸ¯', prompt:'Write a WhatsApp penalty kick post. Build up the tension. Include who is taking it and the situation.' },
};

function loadCustomTemplates() {
  const custom = JSON.parse(localStorage.getItem('ap_templates') || '[]');
  const row = document.getElementById('tpl-row');
  row.querySelectorAll('.custom-tpl').forEach(c => c.remove());
  custom.forEach((t, i) => {
    const chip = document.createElement('span');
    chip.className = 'tpl-chip custom-tpl';
    chip.innerHTML = `${t.icon||'âœ¦'} ${t.name}<span class="tpl-del" onclick="deleteCustomTemplate(event,${i})">âœ•</span>`;
    chip.addEventListener('click', function(e) {
      if (e.target.classList.contains('tpl-del')) return;
      pickTpl(this, `custom_${i}`);
    });
    row.appendChild(chip);
  });
}

function saveCustomTemplate() {
  const name = document.getElementById('tpl-name-inp').value.trim();
  if (!name) { toast('Enter a template name','err'); return; }
  const custom = JSON.parse(localStorage.getItem('ap_templates') || '[]');
  custom.push({ name, icon: document.getElementById('tpl-icon-inp').value.trim() || 'âœ¦', prompt: document.getElementById('tpl-prompt-inp').value.trim() });
  localStorage.setItem('ap_templates', JSON.stringify(custom));
  loadCustomTemplates();
  ['tpl-name-inp','tpl-icon-inp','tpl-prompt-inp'].forEach(id => document.getElementById(id).value='');
  closeModal('modal-tpl');
  toast(`Template "${name}" saved âœ“`,'wa');
}

function deleteCustomTemplate(e, idx) {
  e.stopPropagation();
  const custom = JSON.parse(localStorage.getItem('ap_templates') || '[]');
  custom.splice(idx,1);
  localStorage.setItem('ap_templates', JSON.stringify(custom));
  if (currentTpl === `custom_${idx}`) currentTpl = 'default';
  loadCustomTemplates();
  toast('Template deleted','inf');
}

function getTemplatePrompt() {
  if (currentTpl.startsWith('custom_')) {
    const idx = parseInt(currentTpl.replace('custom_',''));
    const custom = JSON.parse(localStorage.getItem('ap_templates') || '[]');
    return custom[idx]?.prompt || '';
  }
  return BUILTIN_TPLS[currentTpl]?.prompt || BUILTIN_TPLS.default.prompt;
}

function pickTpl(el, tpl) {
  document.querySelectorAll('.tpl-chip').forEach(c => c.classList.remove('on'));
  el.classList.add('on');
  currentTpl = tpl;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GENERATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generate() {
  if (['live','preview'].includes(currentType) && !selectedMatchId) {
    toast('Select a match first','err');
    // Switch to matches on mobile
    if (window.innerWidth <= 768) {
      mobileNav('left', document.getElementById('mnav-matches'));
    }
    return;
  }
  const ph  = document.getElementById('msg-ph');
  const txt = document.getElementById('msg-txt');
  const ov  = document.getElementById('gen-overlay');
  const btn = document.getElementById('gen-btn');
  const st  = document.getElementById('gen-status');
  ph.style.display='none'; txt.style.display='none';
  ov.style.display='flex';
  document.getElementById('share-section').style.display='none';
  document.getElementById('share-always').style.display='none';
  btn.disabled=true; btn.innerHTML='GENERATINGâ€¦';
  const statuses=['Crafting your messageâ€¦','Fetching match dataâ€¦','Applying toneâ€¦','Polishing for WhatsAppâ€¦'];
  let si=0; st.textContent=statuses[0];
  const iv=setInterval(()=>{ si=(si+1)%statuses.length; st.textContent=statuses[si]; },1200);
  const lang = document.getElementById('lang').value;
  const isRTL = ['ar','fa','he','ur'].includes(lang);
  try {
    const s = cfg();
    const aff = JSON.parse(localStorage.getItem('ap_affiliate')||'{}');
    const payload = {
      message_type:    currentType,
      tone:            document.getElementById('tone').value,
      length:          document.getElementById('length').value,
      language:        lang,
      include_stats:   document.getElementById('inc-stats').checked,
      include_players: document.getElementById('inc-players').checked,
      include_h2h:     document.getElementById('inc-h2h').checked,
      include_emojis:  document.getElementById('inc-emojis').checked,
      template:        currentTpl,
      template_prompt: getTemplatePrompt(),
      custom_prompt:   document.getElementById('custom-txt')?.value || '',
      platform:        'whatsapp',
    };
    if (aff.url && document.getElementById('inc-aff').checked)
      payload.affiliate_line = `\nâ”â”â”â”â”â”â”â”â”â”â”â”\n${aff.label||'ğŸ”— Support us'} â†’ ${aff.url}`;
    if (['live','preview'].includes(currentType)) {
      const m = allMatches.find(m=>m.fixture.id===selectedMatchId);
      if (m) payload.match_data = m;
    }
    const res  = await fetch(base()+'/api/ai/generate', {
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
    });
    const data = await res.json();
    generatedMsg = data.message;
  } catch {
    await new Promise(r=>setTimeout(r,900));
    generatedMsg = buildFallbackMessage();
  }
  if (document.getElementById('inc-hashtags').checked) {
    const m = allMatches.find(m=>m.fixture.id===selectedMatchId);
    if (m) {
      const leagueMap={'Premier League':'PremierLeague','La Liga':'LaLiga','Serie A':'SerieA','Champions League':'UCL'};
      const tags=[m.teams.home.name.replace(/\s/g,''), m.teams.away.name.replace(/\s/g,''), leagueMap[m.league.name]||m.league.name.replace(/\s/g,''), 'Football'];
      generatedMsg += '\n\n' + tags.map(t=>'#'+t).join(' ');
    }
  }
  clearInterval(iv);
  ov.style.display='none';
  btn.disabled=false;
  btn.innerHTML='<span style="font-size:18px;">ğŸ’¬</span> GENERATE MESSAGE';
  txt.textContent=generatedMsg; txt.className='msg-generated'; txt.style.display='block';
  const body = document.getElementById('msg-body');
  body.classList.toggle('rtl', isRTL);
  txt.style.direction = isRTL ? 'rtl' : 'ltr';
  txt.style.textAlign = isRTL ? 'right' : 'left';
  document.getElementById('gen-ts').textContent = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  document.getElementById('msg-footer-l').textContent = 'Generated Â· ready to share on WhatsApp';
  document.getElementById('share-section').style.display='block';
  document.getElementById('share-always').style.display='none';
  document.getElementById('sched-msg-preview').value = generatedMsg.substring(0,200);
  updateCharLimits();
  saveToHistory(generatedMsg);
  toast('Message ready! Tap Share ğŸ’¬','wa');
}

function buildFallbackMessage() {
  const m = allMatches.find(m=>m.fixture.id===selectedMatchId);
  const tone = document.getElementById('tone').value;
  const aff  = JSON.parse(localStorage.getItem('ap_affiliate')||'{}');
  let msg = '';
  if (m) {
    const score  = m.goals.home!==null ? `${m.goals.home}â€“${m.goals.away}` : 'vs';
    const status = m.fixture.status;
    const toneOpener = {excited:'ğŸ”¥ MATCH ALERT!',dramatic:'âš¡ THE DRAMA UNFOLDS!',casual:'Hey football fans! ğŸ‘‹',professional:'Match Update',analytical:'Statistical Update:',poetic:'Where passion meets pitchâ€¦'}[tone] || 'Match Update';
    const useEmoji = document.getElementById('inc-emojis').checked;
    msg = `${toneOpener}\n\n${m.teams.home.name} ${score} ${m.teams.away.name}\n${m.league.name} Â· ${m.league.round||''}\n${status.elapsed?'â± '+status.elapsed+"'":status.short==='FT'?'âš¡ Final Whistle':'â³ Upcoming'}\n${m.fixture.venue?.name?'ğŸ“ '+m.fixture.venue.name:''}\n\n${useEmoji?'âš½ Follow for live updates!':'Follow for live updates!'}`;
  } else if (currentType === 'standings') {
    const leagueName = document.getElementById('pref-league').options[document.getElementById('pref-league').selectedIndex]?.text || 'League';
    msg = `ğŸ† ${leagueName.replace(/[^\w\s]/g,'').trim()} Standings\n\nConnect your API in Settings to get live standings data.\n\nâš™ï¸ Open Settings to configure`;
  } else if (currentType === 'digest') {
    msg = `ğŸ“Š ${fmtDate(currentDate)} Football Digest\n\nConnect your API in Settings to generate a full digest.\n\nâš™ï¸ Open Settings to configure`;
  } else {
    msg = `ğŸ’¬ Ready to post!\n\nConfigure your API in Settings to generate live match messages.\n\nThis is a demo message.`;
  }
  if (aff.url && document.getElementById('inc-aff').checked)
    msg += `\nâ”â”â”â”â”â”â”â”â”â”â”â”\n${aff.label||'ğŸ”— Support us'} â†’ ${aff.url}`;
  return msg;
}

function regenerate() { generate(); }

function editMsg() {
  const txt = document.getElementById('msg-txt');
  const btn = document.getElementById('edit-btn');
  if (txt.contentEditable === 'true') {
    txt.contentEditable = 'false';
    generatedMsg = txt.textContent;
    btn.innerHTML = 'âœï¸ Edit';
    updateCharLimits();
    toast('Edits saved','wa');
  } else {
    txt.contentEditable = 'true';
    txt.focus();
    btn.innerHTML = 'âœ“ Done';
    txt.oninput = () => { generatedMsg = txt.textContent; updateCharLimits(); };
  }
}

function saveMsg() {
  if (generatedMsg) saveToHistory(generatedMsg);
  toast('Saved to history âœ“','wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CHAR LIMITS (WhatsApp focused)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateCharLimits() {
  const len = generatedMsg.length;
  document.getElementById('char-count').textContent = len + ' chars';
  // WhatsApp has no hard limit but ideal is under ~1000 for broadcasts
  const waEl = document.getElementById('pb-wa');
  if (waEl) {
    waEl.textContent = `${len} chars`;
    waEl.className = 'pbc ' + (len > 1000 ? 'warn' : 'ok');
  }
  const igEl = document.getElementById('pb-ig');
  if (igEl) {
    igEl.textContent = `${len}/2200`;
    igEl.className = 'pbc ' + (len > 2200 ? 'over' : len > 1800 ? 'warn' : 'ok');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// QUICK POSTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function quickPost(type, player, minute, team) {
  if (!selectedMatchId) { toast('Select a match first','err'); return; }
  const m = allMatches.find(m=>m.fixture.id===selectedMatchId);
  if (!m) return;
  const h=m.goals.home??0, a=m.goals.away??0;
  const useEmoji = document.getElementById('inc-emojis').checked;
  const posts = {
    goal:     `${useEmoji?'âš½ ':''}GOAL! ${minute?minute+"' ":''}${player?player.toUpperCase()+' scores!':'GOAL!'}\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\n${m.league.name}${team?'\n'+team:''}\n\n${useEmoji?'ğŸ”¥ Follow for more updates!':'Follow for more updates!'}`,
    halftime: `${useEmoji?'ğŸ”” ':''}HALF TIME\n\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\n${m.league.name}\n\n${useEmoji?'ğŸ“² Second half incoming!':'Second half incoming!'}`,
    fulltime:  `${useEmoji?'ğŸ ':''}FULL TIME\n\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\n${m.league.name}\n\n${useEmoji?'âš¡ What a match!':'What a match!'}`,
    red:       `${useEmoji?'ğŸŸ¥ ':''}RED CARD! ${minute?minute+"' ":''}\n${player||'A player'} sent off!\n${team||''} down to 10 men.\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}`,
    yellow:    `${useEmoji?'ğŸŸ¨ ':''}YELLOW CARD! ${minute?minute+"' ":''}\n${player||'A player'} booked.\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}`,
    penalty:   `${useEmoji?'ğŸ¯ ':''}PENALTY!\n\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\nThe referee points to the spot!\n\n${useEmoji?'ğŸ˜± Who will step up?':'Who will step up?'}`,
    var:       `${useEmoji?'ğŸ“º ':''}VAR REVIEW\n\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\nThe VAR is checkingâ€¦`,
    kickoff:   `${useEmoji?'ğŸŸï¸ ':''}KICK OFF!\n\n${m.teams.home.name} vs ${m.teams.away.name}\n${m.league.name}\n\n${useEmoji?'âš½ Here we go!':'Here we go!'}`,
    injury:    `${useEmoji?'ğŸš‘ ':''}INJURY UPDATE\n\n${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\nA player is down and receiving treatment.`,
    summary:   `${useEmoji?'ğŸ”´ ':''}LIVE: ${m.teams.home.name} ${h}â€“${a} ${m.teams.away.name}\n${m.league.name}${m.fixture.status.elapsed?' Â· '+m.fixture.status.elapsed+"'":''}\n\n${useEmoji?'ğŸ“² Stay tuned for updates!':'Stay tuned for updates!'}`,
  };
  generatedMsg = posts[type] || posts.summary;
  const aff = JSON.parse(localStorage.getItem('ap_affiliate')||'{}');
  if (aff.url && document.getElementById('inc-aff').checked)
    generatedMsg += `\nâ”â”â”â”â”â”â”â”â”â”â”â”\n${aff.label||'ğŸ”— Support us'} â†’ ${aff.url}`;
  const txt = document.getElementById('msg-txt');
  txt.textContent = generatedMsg; txt.style.display='block';
  document.getElementById('msg-ph').style.display='none';
  document.getElementById('share-section').style.display='block';
  document.getElementById('share-always').style.display='none';
  document.getElementById('gen-ts').textContent = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  document.getElementById('msg-footer-l').textContent = 'Quick post ready Â· tap Share!';
  updateCharLimits();
  toast('Quick post ready! ğŸ’¬','wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHARING â€” WhatsApp Only
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shareWhatsApp() {
  if (!generatedMsg) { toast('Generate a message first','err'); return; }
  window.open('https://wa.me/?text='+encodeURIComponent(generatedMsg),'_blank');
}

function shareWhatsAppStatus() {
  if (!generatedMsg) { toast('Generate a message first','err'); return; }
  // Copy to clipboard first, then open WhatsApp
  navigator.clipboard.writeText(generatedMsg).then(() => {
    toast('Copied! Open WhatsApp â†’ Status â†’ paste ğŸ“‹','wa');
    window.open('https://api.whatsapp.com/send','_blank');
  }).catch(() => {
    window.open('https://wa.me/?text='+encodeURIComponent(generatedMsg),'_blank');
  });
}

function copyMsg() {
  if (!generatedMsg) { toast('Nothing to copy yet','err'); return; }
  navigator.clipboard.writeText(generatedMsg)
    .then(() => toast('Copied âœ“','wa'))
    .catch(() => {
      const ta = document.createElement('textarea');
      ta.value = generatedMsg; document.body.appendChild(ta); ta.select();
      document.execCommand('copy'); document.body.removeChild(ta);
      toast('Copied âœ“','wa');
    });
}

function downloadMsg() {
  if (!generatedMsg) { toast('Generate a message first','err'); return; }
  const m = allMatches.find(m=>m.fixture.id===selectedMatchId);
  const fname = m
    ? `${m.teams.home.name.replace(/\s/g,'-')}-vs-${m.teams.away.name.replace(/\s/g,'-')}-${new Date().toISOString().split('T')[0]}.txt`
    : `autopost-${Date.now()}.txt`;
  const blob = new Blob([generatedMsg],{type:'text/plain'});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=fname; a.click(); URL.revokeObjectURL(a.href);
  toast('Downloaded â¬‡','wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HISTORY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveToHistory(msg) {
  if (!msg) return;
  const posts = JSON.parse(localStorage.getItem('ap_posts')||'[]');
  const m = allMatches.find(m=>m.fixture.id===selectedMatchId)||{teams:{home:{name:'Message'},away:{name:''}}};
  posts.unshift({
    id: Date.now(),
    title: `${m.teams.home.name} vs ${m.teams.away.name}`,
    preview: msg.substring(0,80),
    message: msg,
    type: currentType,
    timestamp: new Date().toISOString()
  });
  localStorage.setItem('ap_posts', JSON.stringify(posts.slice(0,50)));
  loadHistoryFromStorage();
}

function loadHistoryFromStorage() {
  const posts = JSON.parse(localStorage.getItem('ap_posts')||'[]');
  const renderFn = (id) => {
    const el = document.getElementById(id);
    if (!el) return;
    if (!posts.length) { el.innerHTML='<div class="empty">No history yet</div>'; return; }
    el.innerHTML = posts.slice(0,20).map(p=>`
      <div class="hist-item" onclick='loadHistoryMsg(${JSON.stringify(p.message)})'>
        <div class="hi-top"><span class="hi-title">${p.title||'Message'}</span><span class="hi-time">${new Date(p.timestamp).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</span></div>
        <div class="hi-prev">${(p.preview||'').substring(0,70)}â€¦</div>
      </div>`).join('');
  };
  renderFn('hist-list');
  renderFn('hist-list-modal');
}

function loadHistoryMsg(msg) {
  generatedMsg = msg;
  const txt = document.getElementById('msg-txt');
  txt.textContent = msg; txt.style.display='block';
  document.getElementById('msg-ph').style.display='none';
  document.getElementById('share-section').style.display='block';
  document.getElementById('share-always').style.display='none';
  document.getElementById('gen-ts').textContent = new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});
  document.getElementById('msg-footer-l').textContent = 'Loaded from history';
  updateCharLimits();
  closeModal('modal-history');
  // Switch to message view on mobile
  if (window.innerWidth <= 768) {
    const right = document.getElementById('col-right');
    const left  = document.getElementById('col-left');
    right.classList.add('active'); left.classList.remove('active');
    document.querySelectorAll('.mnav-btn').forEach(b=>b.classList.remove('on'));
    document.getElementById('mnav-message').classList.add('on');
  }
}

function clearHistory() {
  if (!confirm('Clear all history?')) return;
  localStorage.removeItem('ap_posts');
  document.getElementById('hist-list').innerHTML='<div class="empty">History cleared</div>';
  if (document.getElementById('hist-list-modal'))
    document.getElementById('hist-list-modal').innerHTML='<div class="empty">History cleared</div>';
  toast('History cleared','inf');
}

function exportHistory(format) {
  const posts = JSON.parse(localStorage.getItem('ap_posts')||'[]');
  if (!posts.length) { toast('No history to export','err'); return; }
  let content, filename, mime;
  if (format === 'json') {
    content  = JSON.stringify(posts, null, 2);
    filename = `autopost-history-${new Date().toISOString().split('T')[0]}.json`;
    mime     = 'application/json';
  } else {
    const header = 'ID,Title,Timestamp,Type,Preview,Message\n';
    const rows   = posts.map(p=>[p.id,`"${(p.title||'').replace(/"/g,'""')}"`,p.timestamp,p.type||'',`"${(p.preview||'').replace(/"/g,'""')}"`,`"${(p.message||'').replace(/"/g,'""').replace(/\n/g,'\\n')}"`].join(','));
    content  = header + rows.join('\n');
    filename = `autopost-history-${new Date().toISOString().split('T')[0]}.csv`;
    mime     = 'text/csv';
  }
  const blob = new Blob([content],{type:mime});
  const a = document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=filename; a.click(); URL.revokeObjectURL(a.href);
  toast(`Exported ${posts.length} posts â¬‡`,'wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCHEDULED POSTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadScheduledPosts() {
  const sched = JSON.parse(localStorage.getItem('ap_scheduled')||'[]');
  const list  = document.getElementById('sched-list-mini');
  if (!sched.length) {
    list.innerHTML='<div class="empty" style="padding:12px 16px;font-size:11px;">No scheduled posts</div>';
    return;
  }
  const sorted = [...sched].sort((a,b)=>new Date(a.datetime)-new Date(b.datetime));
  list.innerHTML = sorted.slice(0,5).map(s=>`
    <div class="sched-item">
      <div class="si-time">${new Date(s.datetime).toLocaleString([],{month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'})}</div>
      <div class="si-info"><div class="si-title">${s.note||s.title||'Post'}</div><div class="si-ch">WhatsApp reminder</div></div>
      <span class="si-status ${s.status||'pending'}">${(s.status||'pending').toUpperCase()}</span>
      <button class="mb red" onclick="removeScheduled(${s.id})" style="padding:2px 7px;font-size:10px;">âœ•</button>
    </div>`).join('');
}

function schedulePost() {
  const dt  = document.getElementById('sched-dt').value;
  const msg = document.getElementById('sched-msg-preview').value.trim() || generatedMsg;
  const note = document.getElementById('sched-note').value.trim();
  if (!dt)  { toast('Pick a date and time','err'); return; }
  if (new Date(dt) <= new Date()) { toast('Choose a future time','err'); return; }
  if (!msg) { toast('No message to schedule','err'); return; }
  const sched = JSON.parse(localStorage.getItem('ap_scheduled')||'[]');
  sched.push({ id:Date.now(), datetime:dt, note, title:msg.substring(0,40)+'â€¦', message:msg, status:'pending' });
  localStorage.setItem('ap_scheduled', JSON.stringify(sched));
  loadScheduledPosts();
  closeModal('modal-schedule');
  toast(`Reminder set for ${new Date(dt).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})} âœ“`,'wa');
}

function removeScheduled(id) {
  let sched = JSON.parse(localStorage.getItem('ap_scheduled')||'[]');
  sched = sched.filter(s=>s.id!=id);
  localStorage.setItem('ap_scheduled', JSON.stringify(sched));
  loadScheduledPosts();
  toast('Removed','inf');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AFFILIATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadAffiliate() {
  const aff = JSON.parse(localStorage.getItem('ap_affiliate')||'{}');
  if (aff.label) document.getElementById('aff-label').value = aff.label;
  if (aff.url)   document.getElementById('aff-url').value   = aff.url;
}

function saveAffiliate() {
  const aff = {label:document.getElementById('aff-label').value, url:document.getElementById('aff-url').value};
  localStorage.setItem('ap_affiliate', JSON.stringify(aff));
  toast('Affiliate link saved âœ“','wa');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TYPE TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setType(type, el) {
  currentType = type;
  document.querySelectorAll('.ttab').forEach(t=>t.classList.remove('on'));
  if (el) el.classList.add('on');
  const isMatch = ['live','preview'].includes(type);
  document.getElementById('match-sec-hdr').style.display    = isMatch ? 'flex' : 'none';
  document.getElementById('match-search-wrap').style.display = isMatch ? 'block' : 'none';
  document.getElementById('custom-prompt').style.display    = type==='custom' ? 'block' : 'none';
  document.getElementById('date-nav').style.display         = (isMatch||type==='digest') ? 'flex' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RTL SUPPORT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onLangChange() {
  const lang = document.getElementById('lang').value;
  const isRTL = ['ar','fa','he','ur'].includes(lang);
  const body  = document.getElementById('msg-body');
  const txt   = document.getElementById('msg-txt');
  if (body) body.classList.toggle('rtl', isRTL);
  if (txt)  { txt.style.direction = isRTL?'rtl':'ltr'; txt.style.textAlign = isRTL?'right':'left'; }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODALS + TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openModal(id)  { document.getElementById(id)?.classList.add('open'); }
function closeModal(id) { document.getElementById(id)?.classList.remove('open'); }
document.querySelectorAll('.modal-bg').forEach(m=>m.addEventListener('click',e=>{ if(e.target===m) m.classList.remove('open'); }));

const TC={ok:'t-ok',err:'t-err',inf:'t-inf',wa:'t-wa'};
function toast(msg, type='ok') {
  const el=document.getElementById('toast'); el.textContent=msg;
  el.className=TC[type]||'t-ok'; el.style.display='block';
  clearTimeout(el._t); el._t=setTimeout(()=>el.style.display='none',3500);
}
</script>
</body>
</html>